import { prepareLanguage } from './i18n-esbuild.mjs';

const cache = new Map();

export default async (req, res, next) => {
  const regexp = /^\/i18n\/(?<lang>\w*).json/.exec(req.url);
  const lang = regexp?.groups?.lang;
  if (lang) {
    if (!cache.has(lang)) {
      cache.set(lang, JSON.stringify(await prepareLanguage(lang)));
    }
    res.end(cache.get(lang));
  } else {
    next();
  }
};
