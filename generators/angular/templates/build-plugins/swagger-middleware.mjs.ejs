import { readFile } from 'node:fs/promises';
import { getSwaggerUiFileMap } from './swagger-esbuild.mjs';

const swaggerFiles = await getSwaggerUiFileMap();
swaggerFiles['swagger-ui'] = swaggerFiles['swagger-ui/index.html'];
const cache = new Map();

export default async (req, res, next) => {
  const file = swaggerFiles[req.url.slice(1)];
  if (file) {
    if (!cache.has(file)) {
      cache.set(file, await readFile(file, 'utf8'));
    }
    res.end(cache.get(file));
  } else {
    next();
  }
};
