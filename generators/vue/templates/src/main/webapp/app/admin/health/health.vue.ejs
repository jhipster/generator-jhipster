<template>
  <div>
    <h2>
      <span id="health-page-heading" data-cy="healthPageHeading" v-text="t$('health.title')">Health Checks</span>
      <button class="btn btn-primary float-right" :disabled="updatingHealth" @click="refresh()">
        <font-awesome-icon icon="sync" /> <span v-text="t$('health[\'refresh.button\']')">Refresh</span>
      </button>
    </h2>
    <div class="table-responsive">
      <table id="healthCheck" class="table table-striped" aria-describedby="Health check">
        <thead>
          <tr>
            <th scope="col" v-text="t$('health.table.service')">Service Name</th>
            <th class="text-center" scope="col" v-text="t$('health.table.status')">Status</th>
            <th class="text-center" scope="col" v-text="t$('health.details.details')">Details</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="health of healthData" :key="health.name">
            <td><% if (enableTranslation) { %><span v-text="t$('health.indicator.' + baseName(health.name))" /><% } else { %><span class="text-capitalize">{{ baseName(health.name) }}</span><% } %> {{ subSystemName(health.name) }}</td>
            <td class="text-center">
              <span class="badge" :class="getBadgeClass(health.status)" v-text="t$('health.status.' + health.status)">
                {{ health.status }}
              </span>
            </td>
            <td class="text-center">
              <a v-if="health.details || health.error" class="hand" @click="showHealth(health)">
                <font-awesome-icon icon="eye" />
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <b-modal ref="healthModal">
      <template #modal-title>
        <h4 v-if="currentHealth" class="modal-title" id="showHealthLabel">
<%_ if (enableTranslation) { _%>
          <span v-text="t$('health.indicator.' + baseName(currentHealth.name))" />
<%_ } else { _%>
          <span class="text-capitalize">{{ baseName(currentHealth.name) }}</span>
<%_ } _%>
        {{ subSystemName(currentHealth.name) }}
        </h4>
      </template>
      <health-modal :current-health="currentHealth" />
    </b-modal>
  </div>
</template>

<script lang="ts" src="./health.component.ts"></script>
