import { createHelpers } from 'yeoman-test';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';
// eslint-disable-next-line import/no-unresolved
import { EnvironmentBuilder } from 'generator-jhipster/cli';
import { createJHipsterLogger } from 'generator-jhipster/generators/base/support';

const packageRoot = join(dirname(fileURLToPath(import.meta.url)), '..');
const jhipsterPath = join(packageRoot, 'node_modules', 'generator-jhipster');

export function createTestHelpers(options = {}) {
  return createHelpers({
    ...options,
    createEnv: EnvironmentBuilder.createEnv,
    adapterOptions: { log: createJHipsterLogger() },
  });
}

export const helpers = createTestHelpers();

export const lookups = [
  { packagePaths: [jhipsterPath], lookups: ['dist/generators'] },
  { packagePaths: [packageRoot], lookups: ['generators'] },
];
