import { convertToParamMap, ParamMap, Params } from '@angular/router';
import { FilterOptions, IFilterOptions } from './filter.model';

describe('FilterModel Tests', () => {
  const oneValidParam: Params = {
    test: 'blub',
    'filter[hello.in]': 'world',
    'filter[invalid': 'invalid',
    filter_invalid2: 'invalid',
  };

  const noValidParam: Params = {
    test: 'blub',
    'filter[invalid': 'invalid',
    filter_invalid2: 'invalid',
  };

  const paramWithTwoValues: Params = {
    'filter[hello.in]': ['world', 'world2'],
  };

  it('should parse from Params if there are any', () => {
    const filters: IFilterOptions = new FilterOptions();

    const paramMap: ParamMap = convertToParamMap(oneValidParam);

    filters.initializeFromParams(paramMap);

    expect(filters.hasAnyFilterSet()).toBeTruthy();

    expect(filters.filterOptions).toMatchObject([{ name: 'hello.in', values: ['world'] }]);
  });

  it('should parse from Params and have none if there are none', () => {
    const filters: IFilterOptions = new FilterOptions();

    const paramMap: ParamMap = convertToParamMap(noValidParam);

    filters.initializeFromParams(paramMap);

    expect(filters.hasAnyFilterSet()).toBeFalsy();
  });

  it('should parse from Params and have a parameter with 2 values', () => {
    const filters: IFilterOptions = new FilterOptions();

    const paramMap: ParamMap = convertToParamMap(paramWithTwoValues);

    filters.initializeFromParams(paramMap);

    expect(filters.filterOptions).toMatchObject([{ name: 'hello.in', values: ['world', 'world2'] }]);
  });
});
